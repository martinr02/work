<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ö–ü–ò</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 800px; margin: 20px auto; padding: 20px; background-color: #f5f5f5; }
    .container { background: white; padding: 25px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    .hours-section { background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
    .kpi-item { margin: 15px 0; padding: 15px; border-left: 4px solid #007bff; background: #f8f9fa; }
    input, select { padding: 8px; margin: 5px 0; width: 200px; border: 1px solid #ddd; border-radius: 4px; }
    .progress-bar { height: 20px; background: #eee; border-radius: 10px; margin: 10px 0; position: relative; }
    .progress-fill { height: 100%; border-radius: 10px; background: #aaa; transition: width 0.3s ease, background-color 0.3s ease; }
    .result-box { background: #007bff; color: white; padding: 20px; border-radius: 8px; margin-top: 20px; text-align: center; }
    .total-after-tax { font-size: 28px; font-weight: bold; color: #ffdd57; background: rgba(0,0,0,0.2); padding: 10px; border-radius: 8px; margin: 15px 0; display: inline-block; }
    .total-after-tax::before { content: "üíµ "; }
    .total-before-tax { font-size: 20px; color: #cce5ff; }
    .hours-coefficient { font-size: 14px; color: #cce5ff; }
    .kpi-percentage { font-size: 18px; color: #ffdd57; margin-top: 10px; }
  </style>
</head>
<body>
  <div class="container">
    <h2>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ö–ü–ò</h2>
    <div class="hours-section">
      <h3>–£—á–µ—Ç –æ—Ç—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —á–∞—Å–æ–≤</h3>
      <label for="month-select">–ú–µ—Å—è—Ü:</label><br />
      <select id="month-select">
        <option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ –º–µ—Å—è—Ü</option>
        <option>–Ø–Ω–≤–∞—Ä—å</option><option>–§–µ–≤—Ä–∞–ª—å</option><option>–ú–∞—Ä—Ç</option><option>–ê–ø—Ä–µ–ª—å</option>
        <option>–ú–∞–π</option><option>–ò—é–Ω—å</option><option>–ò—é–ª—å</option><option>–ê–≤–≥—É—Å—Ç</option>
        <option>–°–µ–Ω—Ç—è–±—Ä—å</option><option>–û–∫—Ç—è–±—Ä—å</option><option>–ù–æ—è–±—Ä—å</option><option>–î–µ–∫–∞–±—Ä—å</option>
      </select><br/>
      <label for="hours-input">–ù–æ—Ä–º–∞ —á–∞—Å–æ–≤:</label><br />
      <input type="number" id="hours-input" readonly><br/>
      <label for="hours">–û—Ç—Ä–∞–±–æ—Ç–∞–Ω–æ —á–∞—Å–æ–≤:</label><br />
      <input type="number" id="hours" placeholder="–û—Ç—Ä–∞–±–æ—Ç–∞–Ω–æ —á–∞—Å–æ–≤ –≤ –º–µ—Å—è—Ü–µ" min="0" max="744">
      <div class="progress-bar"><div class="progress-fill" id="hours-progress"></div></div>
      <div id="hours-warning" style="color: #dc3545; display: none;">–ù–æ—Ä–º–∞: –º–µ–Ω—å—à–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–π</div>
    </div>

    <!-- KPI Items -->
    <div class="kpi-item">
      <h3>Schedule Adherence (85‚Äì93‚ÄØ%, –≤–µ—Å‚ÄØ20)</h3>
      <input id="sa" placeholder="%"/>
      <div class="progress-bar"><div id="sa-progress" class="progress-fill"></div></div>
    </div>
    <div class="kpi-item">
      <h3>–ö–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞ (83‚Äì95, –≤–µ—Å‚ÄØ40)</h3>
      <input id="kk" placeholder=""/>
      <div class="progress-bar"><div id="kk-progress" class="progress-fill"></div></div>
    </div>
    <div class="kpi-item">
      <h3> –ü—Ä–æ–¥–∞–∂–∞ –ö–õ (50‚Äì70‚ÄØ%, –≤–µ—Å‚ÄØ10)</h3>
      <input id="kl" placeholder="%"/>
      <div class="progress-bar"><div id="kl-progress" class="progress-fill"></div></div>
    </div>
    <div class="kpi-item">
      <h3>–§–∏–∑. –∫–∞—Ä—Ç—ã (3‚Äì7‚ÄØ%, –≤–µ—Å‚ÄØ10)</h3>
      <input id="phy" placeholder="%"/>
      <div class="progress-bar"><div id="phy-progress" class="progress-fill"></div></div>
    </div>
    <div class="kpi-item">
      <h3>–ü—Ä–∏–≤—è–∑–∫–∞ –∫–∞—Ä—Ç (1‚Äì5‚ÄØ%, –≤–µ—Å‚ÄØ5)</h3>
      <input id="link" placeholder="%"/>
      <div class="progress-bar"><div id="link-progress" class="progress-fill"></div></div>
    </div>
    <div class="kpi-item">
      <h3>Repeated Calls (25-28, –≤–µ—Å‚ÄØ10)</h3>
      <input id="rc" placeholder="%"/>
      <div class="progress-bar"><div id="rc-progress" class="progress-fill"></div></div>
    </div>
    <div class="kpi-item">
      <h3>–ò—Ç–æ–≥–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (9‚Äì10, –≤–µ—Å‚ÄØ5)</h3>
      <input id="test" placeholder=""/>
      <div class="progress-bar"><div id="test-progress" class="progress-fill"></div></div>
    </div>

    <div class="result-box">
      <h4>–°—É–º–º–∞ –ö–ü–ò –¥–æ –Ω–∞–ª–æ–≥–∞: <span id="total-before-tax" class="total-before-tax">0 —Å—É–º</span></h4>
      <h4>–°—É–º–º–∞ –ö–ü–ò –ø–æ—Å–ª–µ –Ω–∞–ª–æ–≥–∞: <span id="total-after-tax" class="total-after-tax">0 —Å—É–º</span></h4>
      <div id="hours-coefficient" class="hours-coefficient"></div>
      <div id="kpi-percentage" class="kpi-percentage"></div>
    </div>
  </div>

  <script>
    const BASE_KPI = 1995000;
    const HOURS_NORM = {
      –Ø–Ω–≤–∞—Ä—å:176, –§–µ–≤—Ä–∞–ª—å:160, –ú–∞—Ä—Ç:142, –ê–ø—Ä–µ–ª—å:176,
      –ú–∞–π:167, –ò—é–Ω—å:159, –ò—é–ª—å:184, –ê–≤–≥—É—Å—Ç:168,
      –°–µ–Ω—Ç—è–±—Ä—å:167, –û–∫—Ç—è–±—Ä—å:176, –ù–æ—è–±—Ä—å:160, –î–µ–∫–∞–±—Ä—å:175
    };

    const monthSelect = document.getElementById('month-select');
    const hoursInput  = document.getElementById('hours-input');
    let selectedNorm = 0;

    monthSelect.addEventListener('change', () => {
      selectedNorm = HOURS_NORM[monthSelect.value] || 0;
      hoursInput.value = selectedNorm;
      calculateKPI();
    });

    function parseNumber(v) {
      const t = v.trim();
      return t ? parseFloat(t.replace(',', '.')) : NaN;
    }

    function calculateScore(v, min, max, wt, moreBetter) {
      if (moreBetter) {
        if (v <= min) return 0;
        if (v >= max) return wt;
        return (v - min) / (max - min) * wt;
      } else {
        if (v <= min) return wt;
        if (v >= max) return 0;
        return (max - v) / (max - min) * wt;
      }
    }

    function updateProgress(id, value, maxValue, reverse=false, customMin=null) {
      const el = document.getElementById(id);
      if (isNaN(value)) {
        el.style.width = '0%';
        el.style.backgroundColor = '#eee';
        return;
      }
      let w = (value / maxValue) * 100;
      if (reverse) w = 100 - w;
      w = Math.min(100, Math.max(0, w));
      el.style.width = w + '%';

      let r;
      if (reverse && customMin !== null) {
        r = value <= customMin ? 1
          : value >= maxValue ? 0
          : (maxValue - value) / (maxValue - customMin);
      } else if (!reverse && customMin !== null) {
        r = value <= customMin ? 0
          : value >= maxValue ? 1
          : (value - customMin) / (maxValue - customMin);
      } else {
        r = w / 100;
      }

      if (r <= 0) el.style.backgroundColor = 'rgb(255,0,0)';
      else if (r >= 1) el.style.backgroundColor = 'rgb(0,200,0)';
      else {
        const red   = Math.round(255 * (1 - r));
        const green = Math.round(200 * r);
        el.style.backgroundColor = `rgb(${red},${green},0)`;
      }
    }

    function calculateKPI() {
      // —á–∞—Å—ã
      const hrs   = parseNumber(document.getElementById('hours').value);
      const coeff = !isNaN(hrs) && selectedNorm > 0
                    ? Math.min(hrs / selectedNorm, 1)
                    : 0;

      // –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ KPI
      const sa   = parseNumber(document.getElementById('sa').value);
      const kk   = parseNumber(document.getElementById('kk').value);
      const kl   = parseNumber(document.getElementById('kl').value);
      const phy  = parseNumber(document.getElementById('phy').value);
      const link = parseNumber(document.getElementById('link').value);
      const rc   = parseNumber(document.getElementById('rc').value);
      const test = parseNumber(document.getElementById('test').value);

      // –ø–æ–¥—Å—á—ë—Ç –±–∞–ª–ª–æ–≤
      const saScore   = !isNaN(sa)   ? calculateScore(sa,   85, 93, 20, true) : 0;
      const kkScore   = !isNaN(kk)   ? calculateScore(kk,   83, 95, 40, true) : 0;
      const klScore   = !isNaN(kl)   ? calculateScore(kl,   50, 70, 10, true) : 0;
      const phyScore  = !isNaN(phy)  ? calculateScore(phy,   3,  7, 10, true) : 0;
      const linkScore = !isNaN(link) ? calculateScore(link,  1,  5,  5, true) : 0;
      const rcScore   = !isNaN(rc)   ? calculateScore(rc,   25, 28, 10, false) : 0;
      const testScore = !isNaN(test) ? calculateScore(test,   9, 10,  5, true) : 0;

      const totalScore = saScore + kkScore + klScore + phyScore
                       + linkScore + rcScore + testScore;

      // –≤—ã–ø–ª–∞—Ç—ã
      const beforeTax = totalScore / 100 * BASE_KPI * coeff;
      const afterTax  = beforeTax * 0.925;

      // –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä—ã
      updateProgress('hours-progress', hrs, selectedNorm, false, selectedNorm);
      updateProgress('sa-progress',   sa,   93, false, 85);
      updateProgress('kk-progress',   kk,   95, false, 83);
      updateProgress('kl-progress',   kl,   70, false, 50);
      updateProgress('phy-progress', phy,    7, false,  3);
      updateProgress('link-progress',link,   5, false,  1);
      updateProgress('rc-progress',   rc,   28, true,  25);
      updateProgress('test-progress',test,  10, false,  9);

      // –≤—ã–≤–æ–¥
      document.getElementById('total-before-tax').textContent =
        `${Math.round(beforeTax).toLocaleString('ru-RU')}‚ÄØ—Å—É–º`;
      document.getElementById('total-after-tax').textContent  =
        `${Math.round(afterTax).toLocaleString('ru-RU')}‚ÄØ—Å—É–º`;
      document.getElementById('hours-coefficient').textContent =
        `–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —á–∞—Å–æ–≤: ${(coeff*100).toFixed(1)}%`;
      document.getElementById('kpi-percentage').textContent   =
        `–ü—Ä–æ—Ü–µ–Ω—Ç –æ—Ç –æ–±—â–µ–≥–æ –ö–ü–ò: ${totalScore.toFixed(2)}%`;
      document.getElementById('hours-warning').style.display =
        (!isNaN(hrs) && hrs < selectedNorm) ? 'block' : 'none';
    }

    // –≤–µ—à–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
    document.querySelectorAll('input').forEach(inp =>
      inp.addEventListener('input', calculateKPI)
    );
    window.onload = calculateKPI;
  </script>
</body>
</html>
